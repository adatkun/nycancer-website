<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find a Provider | New York Cancer & Blood Specialists</title>
    <!-- Include your main site CSS -->
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* Directory-specific styles */
        .directory-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .filter-section {
            margin-bottom: 24px;
        }
        
        .filter-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #1e3a8a;
        }
        
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 16px;
        }
        
        .filter-button {
            background-color: #f3f4f6;
            border: 1px solid #e5e7eb;
            color: #374151;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-button:hover {
            background-color: #e5e7eb;
        }
        
        .filter-button.active {
            background-color: #1d4ed8;
            color: white;
            border-color: #1d4ed8;
        }
        
        .search-container {
            margin-bottom: 24px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .results-count {
            margin-bottom: 16px;
            color: #6b7280;
        }
        
        .no-results {
            background-color: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            display: none;
            margin-bottom: 24px;
        }
        
        .no-results-title {
            color: #1e40af;
            font-weight: 500;
            margin-bottom: 8px;
        }
        
        .no-results-message {
            color: #2563eb;
            margin-bottom: 16px;
        }
        
        .clear-filters-button {
            background-color: #2563eb;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .providers-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }
        
        @media (min-width: 768px) {
            .providers-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .provider-card {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            background-color: white;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .provider-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .card-content {
            padding: 20px;
        }
        
        .provider-header {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .provider-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .provider-info h3 {
            color: #1e40af;
            font-weight: 700;
            margin-bottom: 4px;
            font-size: 18px;
        }
        
        .provider-specialty {
            color: #4b5563;
            margin-bottom: 4px;
            font-size: 16px;
        }
        
        .provider-credentials {
            color: #6b7280;
            font-size: 14px;
        }
        
        .info-row {
            display: flex;
            gap: 10px;
            margin-top: 12px;
        }
        
        .info-icon {
            color: #6b7280;
            flex-shrink: 0;
            margin-top: 3px;
        }
        
        .info-content {
            color: #4b5563;
            font-size: 14px;
        }
        
        .tag-container {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 12px;
        }
        
        .tag {
            background-color: #eff6ff;
            color: #1e40af;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .location-tag {
            background-color: #f0fdf4;
            color: #166534;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 16px;
        }
        
        .primary-button {
            flex-grow: 1;
            background-color: #2563eb;
            color: white;
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            text-align: center;
            text-decoration: none;
            transition: background-color 0.2s;
        }
        
        .primary-button:hover {
            background-color: #1d4ed8;
        }
        
        .secondary-button {
            background-color: white;
            color: #2563eb;
            border: 1px solid #2563eb;
            padding: 10px 16px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            transition: background-color 0.2s;
        }
        
        .secondary-button:hover {
            background-color: #eff6ff;
        }
        
        .loading-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #2563eb;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header placeholder - will be filled by your common.js -->
    <div id="header-placeholder"></div>
    
    <!-- Page Header -->
    <section class="page-header">
        <div class="container">
            <h1 class="page-title">Find a Provider</h1>
            <p>Connect with our specialists to receive world-class care close to home.</p>
        </div>
    </section>
    
    <!-- Directory Container -->
    <section class="main-content">
        <div class="container">
            <div class="content-section">
                <div class="directory-container">
                    <!-- Search Box -->
                    <div class="search-container">
                        <input 
                            id="search-input" 
                            type="text" 
                            class="search-input" 
                            placeholder="Search by provider name or specialty..."
                        >
                    </div>
                    
                    <!-- Specialty Filter -->
                    <div class="filter-section">
                        <div class="filter-title">Specialty</div>
                        <div class="filter-buttons" id="specialty-filters">
                            <button class="filter-button active" data-filter="all">All Providers</button>
                            <button class="filter-button" data-filter="Medical Oncology">Medical Oncologists</button>
                            <button class="filter-button" data-filter="Radiation Oncology">Radiation Oncologists</button>
                            <button class="filter-button" data-filter="APP">Advanced Practice Providers</button>
                        </div>
                    </div>
                    
                    <!-- County Filter -->
                    <div class="filter-section">
                        <div class="filter-title">County</div>
                        <div class="filter-buttons" id="county-filters">
                            <button class="filter-button active" data-filter="all">All Counties</button>
                            <button class="filter-button" data-filter="Suffolk">Suffolk</button>
                            <button class="filter-button" data-filter="Nassau">Nassau</button>
                            <button class="filter-button" data-filter="Queens">Queens</button>
                            <button class="filter-button" data-filter="Brooklyn">Brooklyn</button>
                            <button class="filter-button" data-filter="Manhattan">Manhattan</button>
                            <button class="filter-button" data-filter="Staten Island">Staten Island</button>
                            <button class="filter-button" data-filter="Bronx">Bronx</button>
                            <button class="filter-button" data-filter="Westchester">Westchester</button>
                            <button class="filter-button" data-filter="Putnam">Putnam</button>
                            <button class="filter-button" data-filter="Orange">Orange</button>
                        </div>
                    </div>
                    
                    <!-- Loading Indicator -->
                    <div id="loading-indicator" class="loading-indicator">
                        <div class="spinner"></div>
                    </div>
                    
                    <!-- Results Count -->
                    <div id="results-count" class="results-count hidden"></div>
                    
                    <!-- No Results Message -->
                    <div id="no-results" class="no-results">
                        <p class="no-results-title">No providers found matching your criteria.</p>
                        <p class="no-results-message">Try adjusting your filters or search term.</p>
                        <button id="clear-filters-button" class="clear-filters-button">Clear All Filters</button>
                    </div>
                    
                    <!-- Providers Container -->
                    <div id="providers-container" class="providers-container hidden"></div>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Help Section -->
    <div class="content-section" style="text-align: center;">
        <div class="container">
            <h2>We're Here To Help</h2>
            <p>If you have questions or would like to schedule a consultation with one of our specialists, please contact us.</p>
            <a href="#" class="cta-button">Request an Appointment</a>
        </div>
    </div>
    
    <!-- Footer placeholder - will be filled by your common.js -->
    <div id="footer-placeholder"></div>

    <!-- Include your common JS file that loads header and footer -->
    <script src="js/common.js"></script>
    
    <!-- Directory JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // State variables
            let allProviders = [];
            let searchQuery = '';
            let activeSpecialtyFilter = 'all';
            let activeCountyFilter = 'all';
            
            // DOM Elements
            const searchInput = document.getElementById('search-input');
            const specialtyFilters = document.getElementById('specialty-filters');
            const countyFilters = document.getElementById('county-filters');
            const loadingIndicator = document.getElementById('loading-indicator');
            const resultsCount = document.getElementById('results-count');
            const noResults = document.getElementById('no-results');
            const providersContainer = document.getElementById('providers-container');
            const clearFiltersButton = document.getElementById('clear-filters-button');
            
            // Event Listeners
            searchInput.addEventListener('input', handleSearch);
            clearFiltersButton.addEventListener('click', clearFilters);
            
            // Add event listeners to specialty filter buttons
            specialtyFilters.querySelectorAll('.filter-button').forEach(button => {
                button.addEventListener('click', () => {
                    // Update active class
                    specialtyFilters.querySelectorAll('.filter-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    button.classList.add('active');
                    
                    // Update active filter
                    activeSpecialtyFilter = button.getAttribute('data-filter');
                    
                    // Update results
                    updateResults();
                });
            });
            
            // Add event listeners to county filter buttons
            countyFilters.querySelectorAll('.filter-button').forEach(button => {
                button.addEventListener('click', () => {
                    // Update active class
                    countyFilters.querySelectorAll('.filter-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    button.classList.add('active');
                    
                    // Update active filter
                    activeCountyFilter = button.getAttribute('data-filter');
                    
                    // Update results
                    updateResults();
                });
            });
            
            // Functions
            function handleSearch() {
                searchQuery = searchInput.value.toLowerCase();
                updateResults();
            }
            
            function clearFilters() {
                searchInput.value = '';
                searchQuery = '';
                
                // Reset specialty filter
                specialtyFilters.querySelectorAll('.filter-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                specialtyFilters.querySelector('[data-filter="all"]').classList.add('active');
                activeSpecialtyFilter = 'all';
                
                // Reset county filter
                countyFilters.querySelectorAll('.filter-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                countyFilters.querySelector('[data-filter="all"]').classList.add('active');
                activeCountyFilter = 'all';
                
                updateResults();
            }
            
            
            function getFilteredResults() {
                return allProviders.filter(provider => {
                    // Process for providers - filter for only medical oncologists, radiation oncologists, and APPs
                    const isDesiredProviderType = 
                        provider.specialty && (
                            provider.specialty.includes('Medical Oncology') ||
                            provider.specialty.includes('Radiation Oncology') ||
                            provider.specialty.includes('Nurse Practitioner') ||
                            provider.specialty.includes('Physician Assistant')
                        );
                    
                    if (!isDesiredProviderType) return false;
                    
                    // Search query matching
                    const matchesSearch = !searchQuery || 
                        provider.name.toLowerCase().includes(searchQuery) ||
                        (provider.specialty && provider.specialty.toLowerCase().includes(searchQuery));
                    
                    // Specialty filter
                    let matchesSpecialty = activeSpecialtyFilter === 'all';
                    
                    if (activeSpecialtyFilter === 'Medical Oncology') {
                        matchesSpecialty = provider.specialty && provider.specialty.includes('Medical Oncology');
                    } else if (activeSpecialtyFilter === 'Radiation Oncology') {
                        matchesSpecialty = provider.specialty && provider.specialty.includes('Radiation Oncology');
                    } else if (activeSpecialtyFilter === 'APP') {
                        matchesSpecialty = provider.specialty && (
                            provider.specialty.includes('Nurse Practitioner') ||
                            provider.specialty.includes('Physician Assistant')
                        );
                    }
                    
                    // County filter
                    let matchesCounty = activeCountyFilter === 'all';
                    
                    if (activeCountyFilter !== 'all') {
                        // Check if provider works in the selected county
                        matchesCounty = provider.active_locations && provider.active_locations.some(location => {
                            if (location.address) {
                                // Parse county from address
                                return getCountyFromAddress(location.address) === activeCountyFilter;
                            }
                            return false;
                        });
                    }
                    
                    return matchesSearch && matchesSpecialty && matchesCounty;
                });
            }
            
            function updateResults() {
                const filteredResults = getFilteredResults();
                
                // Update results count
                resultsCount.textContent = `${filteredResults.length} providers found`;
                resultsCount.classList.remove('hidden');
                
                // Show/hide no results message
                if (filteredResults.length === 0) {
                    noResults.style.display = 'block';
                    providersContainer.classList.add('hidden');
                } else {
                    noResults.style.display = 'none';
                    providersContainer.classList.remove('hidden');
                    renderProviders(filteredResults);
                }
            }
            
            function renderProviders(providers) {
                providersContainer.innerHTML = '';
                
                providers.forEach(provider => {
                    const card = document.createElement('div');
                    card.className = 'provider-card';
                    
                    // Create credential string
                    const credentials = provider.credentials ? provider.credentials.join(', ') : '';
                    
                    // Create locations HTML
                    let locationsHtml = '';
                    if (provider.active_locations && provider.active_locations.length > 0) {
                        locationsHtml = `
                            <div class="info-row">
                                <div class="info-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M21 10C21 17 12 23 12 23C12 23 3 17 3 10C3 5.02944 7.02944 1 12 1C16.9706 1 21 5.02944 21 10Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <circle cx="12" cy="10" r="3" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                                <div class="info-content">
                                    <div style="margin-bottom: 8px;">Practice Locations:</div>
                                    <div class="tag-container">
                        `;
                        
                        // Get unique counties
                        const counties = new Set();
                        provider.active_locations.forEach(location => {
                            if (location.address) {
                                const county = getCountyFromAddress(location.address);
                                if (county) counties.add(county);
                            }
                        });
                        
                        // Add county tags
                        counties.forEach(county => {
                            locationsHtml += `<span class="tag location-tag">${county}</span>`;
                        });
                        
                        locationsHtml += `
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    // Create languages HTML
                    let languagesHtml = '';
                    if (provider.languages) {
                        const languageArray = provider.languages.split(',').map(lang => lang.trim());
                        
                        languagesHtml = `
                            <div class="info-row">
                                <div class="info-icon">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <line x1="2" y1="12" x2="22" y2="12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        <path d="M12 2C14.5013 4.73835 15.9228 8.29203 16 12C15.9228 15.708 14.5013 19.2616 12 22C9.49872 19.2616 8.07725 15.708 8 12C8.07725 8.29203 9.49872 4.73835 12 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </div>
                                <div class="info-content">
                                    <div style="margin-bottom: 4px;">Languages:</div>
                                    <div class="tag-container">
                        `;
                        
                        languageArray.forEach(language => {
                            languagesHtml += `<span class="tag">${language}</span>`;
                        });
                        
                        languagesHtml += `
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    card.innerHTML = `
                        <div class="card-content">
                            <div class="provider-header">
                                <img 
                                    src="${provider.img || 'https://via.placeholder.com/100'}" 
                                    alt="${provider.name}" 
                                    class="provider-image"
                                    onerror="this.onerror=null; this.src='https://via.placeholder.com/100';"
                                />
                                <div class="provider-info">
                                    <h3>${provider.name}</h3>
                                    <div class="provider-specialty">${provider.specialty || ''}</div>
                                    <div class="provider-credentials">${credentials}</div>
                                </div>
                            </div>
                            
                            ${locationsHtml}
                            ${languagesHtml}
                            
                            <div class="action-buttons">
                                <a 
                                    href="${provider.link}" 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    class="primary-button"
                                >
                                    View Profile
                                </a>
                                ${provider.phone ? `
                                    <a 
                                        href="tel:${provider.phone}"
                                        class="secondary-button"
                                    >
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M22 16.92V19.92C22.0011 20.1985 21.9441 20.4742 21.8325 20.7293C21.7209 20.9845 21.5573 21.2136 21.3521 21.4019C21.1468 21.5901 20.9046 21.7335 20.6407 21.8227C20.3769 21.9119 20.0974 21.9451 19.82 21.92C16.7428 21.5856 13.787 20.5341 11.19 18.85C8.77382 17.3147 6.72533 15.2662 5.18999 12.85C3.49997 10.2412 2.44824 7.27097 2.11999 4.18C2.095 3.90347 2.12787 3.62476 2.21649 3.36162C2.30512 3.09849 2.44756 2.85669 2.63476 2.65162C2.82196 2.44655 3.0498 2.28271 3.30379 2.17052C3.55777 2.05833 3.83233 2.00026 4.10999 2H7.10999C7.5953 1.99522 8.06579 2.16708 8.43376 2.48353C8.80173 2.79999 9.04207 3.23945 9.10999 3.72C9.23662 4.68007 9.47144 5.62273 9.80999 6.53C9.94454 6.88792 9.97366 7.27691 9.8939 7.65088C9.81415 8.02485 9.62886 8.36811 9.35999 8.64L8.08999 9.91C9.51355 12.4135 11.5864 14.4864 14.09 15.91L15.36 14.64C15.6319 14.3711 15.9751 14.1858 16.3491 14.1061C16.7231 14.0263 17.1121 14.0555 17.47 14.19C18.3773 14.5286 19.3199 14.7634 20.28 14.89C20.7658 14.9585 21.2094 15.2032 21.5265 15.5775C21.8437 15.9518 22.0122 16.4296 22 16.92Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                    </a>
                                ` : ''}
                            </div>
                        </div>
                    `;
                    
                    providersContainer.appendChild(card);
                });
            }
            
            // Helper function to determine county from address
            function getCountyFromAddress(address) {
                // This is a simplified implementation - you'd need to enhance this
                // based on your actual address format and counties
                
                if (address.includes("Suffolk") || 
                    address.includes("Babylon") || 
                    address.includes("Patchogue") || 
                    address.includes("Port Jefferson")) {
                    return "Suffolk";
                } else if (address.includes("Nassau") || 
                           address.includes("Hempstead") || 
                           address.includes("Garden City")) {
                    return "Nassau";
                } else if (address.includes("Queens") || 
                           address.includes("Jamaica") || 
                           address.includes("Astoria")) {
                    return "Queens";
                } else if (address.includes("Brooklyn") || 
                           address.includes("Kings County")) {
                    return "Brooklyn";
                } else if (address.includes("Manhattan") || 
                           address.includes("New York, NY")) {
                    return "Manhattan";
                } else if (address.includes("Staten Island") || 
                           address.includes("Richmond County")) {
                    return "Staten Island";
                } else if (address.includes("Bronx")) {
                    return "Bronx";
                } else if (address.includes("Westchester")) {
                    return "Westchester";
                } else if (address.includes("Putnam")) {
                    return "Putnam";
                } else if (address.includes("Orange")) {
                    return "Orange";
                }
                
                // If no direct match, try to extract from ZIP code or city
                if (address.includes("NY") || address.includes("New York")) {
                    const addressParts = address.split(',');
                    if (addressParts.length >= 2) {
                        const cityPart = addressParts[1].trim();
                        
                        // Check cities in Suffolk
                        if (cityPart.includes("Riverhead") || 
                            cityPart.includes("Smithtown") || 
                            cityPart.includes("Islip") ||
                            cityPart.includes("Babylon")) {
                            return "Suffolk";
                        }
                        // Add more city mappings as needed
                    }
                }
                
                return null; // Unknown county
            }
            
            // Fetch providers data from API
            async function fetchData() {
                try {
                    // Show loading indicator
                    loadingIndicator.style.display = 'flex';
                    
                    // Fetch from real API
                    const response = await fetch('https://api.nycancer.com/open/directory/filter/');
                    if (!response.ok) {
                        throw new Error(`API responded with status: ${response.status}`);
                    }
                    const data = await response.json();
                    
                    // Process physicians data
                    allProviders = data.data;
                    
                    // Hide loading indicator and show results
                    loadingIndicator.style.display = 'none';
                    updateResults();
                    
                } catch (err) {
                    console.error("Error fetching providers data:", err);
                    loadingIndicator.style.display = 'none';
                    
                    // Show error message
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'bg-red-50 border border-red-200 rounded-lg p-6 text-center';
                    errorDiv.style.marginBottom = '24px';
                    errorDiv.innerHTML = `
                        <div style="color: #ef4444; margin-bottom: 8px; font-size: 18px;">⚠️ Unable to load providers data: ${err.message}</div>
                        <p style="margin-bottom: 16px;">Please check your API connection and try again.</p>
                        <button 
                            style="background-color: #2563eb; color: white; padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer;"
                            onclick="window.location.reload()"
                        >
                            Try Again
                        </button>
                    `;
                    document.querySelector('.directory-container').appendChild(errorDiv);
                }
            }
            
            // Initialize
            fetchData();
        });
    </script>
</body>
</html>
