<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Locations | New York Imaging Specialists</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://use.typekit.net/ike4wxa.css">
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/header2.css">
  <link rel="stylesheet" href="/css/footer.css">
  
  <style>
    /* ================================================
       ENHANCED SEARCH BAR STYLES
       ================================================ */
    .search-container {
      margin-bottom: 24px;
      position: relative;
    }
    
    .location-search-wrapper {
      position: relative;
      display: flex;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 2px solid #e2e8f0;
      transition: all 0.3s ease;
      overflow: visible;
    }
    
    .location-search-wrapper:focus-within {
      border-color: var(--nyi-blue);
      box-shadow: 0 4px 20px rgba(0, 163, 224, 0.15);
    }
    
    .location-search-wrapper.has-suggestions {
      border-radius: 16px 16px 0 0;
    }
    
    .search-icon-left {
      position: absolute;
      left: 20px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
      font-size: 18px;
      pointer-events: none;
      z-index: 2;
    }
    
    .location-search-input {
      flex: 1;
      border: none;
      padding: 18px 20px 18px 52px;
      font-size: 16px;
      background: transparent;
      outline: none;
      font-family: inherit;
      min-width: 0;
    }
    
    .location-search-input::placeholder {
      color: var(--text-light);
    }
    
    .search-clear-btn {
      background: transparent;
      border: none;
      padding: 0 16px;
      color: var(--text-secondary);
      cursor: pointer;
      font-size: 16px;
      display: none;
      align-items: center;
      transition: color 0.2s ease;
    }
    
    .search-clear-btn:hover {
      color: var(--text-primary);
    }
    
    .search-clear-btn.visible {
      display: flex;
    }
    
    .search-hint {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .search-hint i {
      color: var(--nyi-blue);
    }

    /* ================================================
       AUTOCOMPLETE DROPDOWN
       ================================================ */
    .search-suggestions-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 2px solid var(--nyi-blue);
      border-top: 1px solid #e2e8f0;
      border-radius: 0 0 16px 16px;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      max-height: 400px;
      overflow-y: auto;
      z-index: 1000;
      display: none;
    }
    
    .search-suggestions-dropdown.visible {
      display: block;
      animation: dropdownFade 0.2s ease;
    }
    
    @keyframes dropdownFade {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .suggestion-group {
      border-bottom: 1px solid #e2e8f0;
    }
    
    .suggestion-group:last-child {
      border-bottom: none;
    }
    
    .suggestion-group-header {
      padding: 10px 16px 6px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-light);
      background: var(--bg-light);
    }
    
    .suggestion-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px 16px;
      cursor: pointer;
      transition: all 0.15s ease;
      border-left: 3px solid transparent;
    }
    
    .suggestion-item:hover,
    .suggestion-item.highlighted {
      background: var(--bg-light);
      border-left-color: var(--nyi-teal);
    }
    
    .suggestion-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-size: 14px;
    }
    
    .suggestion-icon.service {
      background: linear-gradient(135deg, var(--nyi-purple), var(--nyi-teal));
      color: white;
    }
    
    .suggestion-icon.location {
      background: linear-gradient(135deg, var(--nyi-navy), var(--nyi-purple));
      color: white;
    }
    
    .suggestion-icon.town {
      background: linear-gradient(135deg, var(--nyi-teal), #00d4aa);
      color: white;
    }
    
    .suggestion-content {
      flex: 1;
      min-width: 0;
    }
    
    .suggestion-title {
      font-weight: 600;
      font-size: 15px;
      color: var(--text-primary);
      margin-bottom: 2px;
    }
    
    .suggestion-title .highlight {
      background: rgba(0, 180, 180, 0.2);
      padding: 0 2px;
      border-radius: 2px;
    }
    
    .suggestion-subtitle {
      font-size: 13px;
      color: var(--text-secondary);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .suggestion-badge {
      background: var(--bg-light);
      color: var(--nyi-navy);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      flex-shrink: 0;
    }
    
    .suggestion-badge.distance {
      background: rgba(0, 180, 180, 0.1);
      color: var(--nyi-teal);
    }
    
    /* Distance badge on location cards */
    .location-card {
      position: relative;
    }
    
    .location-image {
      position: relative;
    }
    
    .distance-badge {
      position: absolute;
      top: 16px;
      right: 16px;
      background: linear-gradient(135deg, var(--nyi-teal), #00d4aa);
      color: white;
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 4px 12px rgba(0, 180, 180, 0.3);
      z-index: 5;
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.3s ease;
    }
    
    .distance-badge.visible {
      opacity: 1;
      transform: translateY(0);
    }
    
    .distance-badge i {
      font-size: 11px;
    }
    
    /* Search context banner */
    .search-context-banner {
      display: none;
      align-items: center;
      gap: 12px;
      background: linear-gradient(135deg, rgba(0, 180, 180, 0.1), rgba(76, 65, 137, 0.1));
      border: 1px solid rgba(0, 180, 180, 0.2);
      border-radius: 12px;
      padding: 14px 20px;
      margin-bottom: 20px;
      animation: slideDown 0.3s ease;
    }
    
    .search-context-banner.visible {
      display: flex;
    }
    
    .search-context-banner i {
      color: var(--nyi-teal);
      font-size: 18px;
    }
    
    .search-context-text {
      flex: 1;
      font-size: 15px;
      color: var(--text-primary);
    }
    
    .search-context-text strong {
      color: var(--nyi-teal);
    }
    
    .clear-context-btn {
      background: white;
      border: 1px solid rgba(0, 0, 0, 0.1);
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--text-secondary);
    }
    
    .clear-context-btn:hover {
      background: var(--nyi-navy);
      color: white;
      border-color: var(--nyi-navy);
    }
    
    .no-suggestions {
      padding: 24px 16px;
      text-align: center;
      color: var(--text-secondary);
    }
    
    .no-suggestions i {
      font-size: 32px;
      color: var(--text-light);
      margin-bottom: 12px;
      display: block;
    }

    /* ================================================
       COLLAPSIBLE MOBILE FILTERS
       ================================================ */
    .filter-toggle-mobile {
      display: none;
      width: 100%;
      background: var(--nyi-navy);
      color: white;
      border: none;
      padding: 16px 24px;
      border-radius: var(--radius-lg);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      transition: all 0.3s ease;
      font-family: inherit;
      margin-bottom: 0;
    }
    
    .filter-toggle-mobile:hover {
      background: var(--nyi-navy-dark);
    }
    
    .filter-toggle-mobile i {
      transition: transform 0.3s ease;
    }
    
    .filter-toggle-mobile.active {
      border-radius: var(--radius-lg) var(--radius-lg) 0 0;
    }
    
    .filter-toggle-mobile.active i {
      transform: rotate(180deg);
    }
    
    .filter-toggle-mobile .filter-count {
      background: rgba(255, 255, 255, 0.2);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 13px;
      font-weight: 500;
    }
    
    .filter-toggle-mobile .toggle-text {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .filter-content-wrapper {
      display: block;
    }
    
    .active-filter-summary {
      display: none;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }
    
    .active-filter-pill {
      background: var(--bg-light);
      color: var(--nyi-navy);
      padding: 6px 14px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    
    .active-filter-pill i {
      font-size: 10px;
      color: var(--nyi-blue);
    }

    @media (max-width: 768px) {
      .filter-toggle-mobile { display: flex; }
      .filter-content-wrapper {
        display: none;
        background: var(--bg-light);
        border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        padding: 0;
        overflow: hidden;
        border: 1px solid rgba(0, 0, 0, 0.05);
        border-top: none;
      }
      .filter-content-wrapper.open { display: block; animation: slideDown 0.3s ease; }
      @keyframes slideDown {
        from { opacity: 0; transform: translateY(-10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .filter-bar { border-radius: 0; margin-bottom: 0; background: white; border: none; box-shadow: none; }
      .filter-group { padding: 20px; border-bottom: 1px solid rgba(0, 0, 0, 0.05); }
      .filter-group:last-child { border-bottom: none; }
      .filter-buttons { gap: 8px; }
      .filter-btn { padding: 8px 14px; font-size: 13px; }
      .active-filter-summary.has-filters { display: flex; }
      .filter-content-wrapper.open + .active-filter-summary { display: none !important; }
      .filter-bar-container { margin-bottom: 24px; }
      .search-suggestions-dropdown { max-height: 300px; }
    }
    
    @media (min-width: 769px) {
      .filter-toggle-mobile { display: none !important; }
      .filter-content-wrapper { display: block !important; }
      .active-filter-summary { display: none !important; }
    }
  </style>
</head>
<body>

<div id="header-placeholder"></div>

<section class="page-hero" style="background-image: url('/img/location-nostrand/nostrand0.jpeg'); background-size: cover; background-position: center;">
  <div class="page-hero-overlay"></div>
  <div class="container page-hero-content">
    <nav class="breadcrumb">
      <a href="/">Home</a>
      <i class="fas fa-chevron-right"></i>
      <span>Locations</span>
    </nav>
    <h1>Our Locations</h1>
    <p class="hero-subtitle">Convenient imaging centers across the New York metropolitan area</p>
  </div>
</section>

<section class="section">
  <div class="container">
    
    <!-- Enhanced Search Bar -->
    <div class="search-container">
      <div class="location-search-wrapper" id="search-wrapper">
        <i class="fas fa-search search-icon-left"></i>
        <input type="text" class="location-search-input" id="location-search" 
               placeholder="Search by location, service, town, or zip code..." 
               autocomplete="off" role="combobox" aria-expanded="false" aria-controls="suggestions-dropdown">
        <button class="search-clear-btn" id="search-clear" aria-label="Clear search">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="search-suggestions-dropdown" id="suggestions-dropdown" role="listbox"></div>
      <p class="search-hint"><i class="fas fa-lightbulb"></i> Try "PET/CT", "Port Jefferson", "11772", or nearby towns</p>
    </div>
    
    <!-- Filter Bar Container -->
    <div class="filter-bar-container">
      <button class="filter-toggle-mobile" id="filter-toggle" aria-expanded="false">
        <span class="toggle-text"><i class="fas fa-sliders"></i> Filter Locations</span>
        <span class="filter-count" id="filter-count">All</span>
        <i class="fas fa-chevron-down"></i>
      </button>
      
      <div class="filter-content-wrapper" id="filter-content">
        <div class="filter-bar">
          <div class="filter-group">
            <div class="filter-label">Filter by Region:</div>
            <div class="filter-buttons" id="region-filters">
              <button class="filter-btn active" data-filter="all">All Regions</button>
              <button class="filter-btn" data-filter="bronx">Bronx</button>
              <button class="filter-btn" data-filter="brooklyn">Brooklyn</button>
              <button class="filter-btn" data-filter="manhattan">Manhattan</button>
              <button class="filter-btn" data-filter="nassau">Nassau</button>
              <button class="filter-btn" data-filter="queens">Queens</button>
              <button class="filter-btn" data-filter="staten-island">Staten Island</button>
              <button class="filter-btn" data-filter="suffolk">Suffolk</button>
            </div>
          </div>
          <div class="filter-group">
            <div class="filter-label">Filter by Service:</div>
            <div class="filter-buttons" id="service-filters">
              <button class="filter-btn active" data-filter="all">All Services</button>
              <button class="filter-btn" data-filter="mri">MRI</button>
              <button class="filter-btn" data-filter="ct">CT</button>
              <button class="filter-btn" data-filter="pet-ct">PET/CT</button>
              <button class="filter-btn" data-filter="mammography">Mammography</button>
              <button class="filter-btn" data-filter="ultrasound">Ultrasound</button>
              <button class="filter-btn" data-filter="bone-density">Bone Density</button>
              <button class="filter-btn" data-filter="x-ray">X-Ray</button>
              <button class="filter-btn" data-filter="interventional-radiology">Interventional Radiology</button>
            </div>
          </div>
        </div>
      </div>
      <div class="active-filter-summary" id="active-filter-summary"></div>
    </div>
    
    <!-- Search Context Banner -->
    <div class="search-context-banner" id="search-context-banner">
      <i class="fas fa-location-dot"></i>
      <span class="search-context-text">
        Showing <strong id="context-count">5</strong> locations within 25 miles of <strong id="context-location">Deer Park, NY</strong>
      </span>
      <button class="clear-context-btn" onclick="resetFilters()">
        <i class="fas fa-times"></i> Show All
      </button>
    </div>
    
    <div class="results-header">
      <div class="results-count"><strong id="results-count">16</strong> locations found</div>
    </div>
    
    <div class="locations-grid" id="locations-grid">
      
      <!-- NY Imaging Eastchester -->
      <a href="/locations/eastchester.html" class="location-card-link" data-region="bronx" data-services="ct ultrasound" data-name="NY Imaging Eastchester" data-address="2330 Eastchester Road, Bronx, NY 10469" data-lat="40.8693" data-lng="-73.8437">
        <div class="location-card">
          <div class="location-image"><img src="/img/eastchester.jpg" alt="NY Imaging Eastchester"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Eastchester</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 2330 Eastchester Road, Bronx, NY 10469</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Fri: 8am-5pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">CT</span>
              <span class="specialty-tag">Ultrasound</span>
            </div>
          </div>
        </div>
      </a>

      <!-- Brooklyn Imaging -->
      <a href="/locations/brooklyn-imaging.html" class="location-card-link" data-region="brooklyn" data-services="pet-ct mri ct" data-name="Brooklyn Imaging" data-address="172 Myrtle Avenue, Brooklyn, NY 11201" data-lat="40.6944" data-lng="-73.9836">
        <div class="location-card">
          <div class="location-image"><img src="/img/myrtle.jpg" alt="Brooklyn Imaging"></div>
          <div class="location-content">
            <h3 class="location-name">Brooklyn Imaging</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 172 Myrtle Avenue, Brooklyn, NY 11201</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Thurs: 8am-5pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">PET/CT</span>
              <span class="specialty-tag">MRI</span>
              <span class="specialty-tag">CT</span>
            </div>
          </div>
        </div>
      </a>

      <!-- NY Imaging Brooklyn (Nostrand) -->
      <a href="/locations/nostrand.html" class="location-card-link" data-region="brooklyn" data-services="pet-ct mri ct mammography ultrasound bone-density" data-name="NY Imaging Brooklyn" data-address="2236 Nostrand Avenue, Brooklyn, NY 11210" data-lat="40.6322" data-lng="-73.9478">
        <div class="location-card">
          <div class="location-image"><img src="/img/nyimagingnostrand.png" alt="NY Imaging Brooklyn"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Brooklyn</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 2236 Nostrand Avenue, Brooklyn, NY 11210</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Fri: 8am-5pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">PET/CT</span>
              <span class="specialty-tag">MRI</span>
              <span class="specialty-tag">CT</span>
              <span class="specialty-tag">Mammography</span>
            </div>
          </div>
        </div>
      </a>

      <!-- NY Imaging Manhattan -->
      <a href="/locations/manhattan.html" class="location-card-link" data-region="manhattan" data-services="pet-ct ct ultrasound" data-name="NY Imaging Manhattan" data-address="201 E 71st Street, New York, NY 10021" data-lat="40.7680" data-lng="-73.9600">
        <div class="location-card">
          <div class="location-image"><img src="/img/manhattan.jpg" alt="NY Imaging Manhattan"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Manhattan</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 201 E 71st Street, New York, NY 10021</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Fri: 8am-4pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">PET/CT</span>
              <span class="specialty-tag">CT</span>
              <span class="specialty-tag">Ultrasound</span>
            </div>
          </div>
        </div>
      </a>

      <!-- NY Imaging Washington Heights -->
      <a href="/locations/washington-heights.html" class="location-card-link" data-region="manhattan" data-services="pet-ct mri ct mammography ultrasound x-ray" data-name="NY Imaging Washington Heights" data-address="500 W 181st Street, New York, NY 10033" data-lat="40.8500" data-lng="-73.9330">
        <div class="location-card">
          <div class="location-image"><img src="/img/washingtonHeights.png" alt="NY Imaging Washington Heights"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Washington Heights</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 500 W 181st Street, New York, NY 10033</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Fri: 8am-5pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">PET/CT</span>
              <span class="specialty-tag">MRI</span>
              <span class="specialty-tag">CT</span>
              <span class="specialty-tag">Mammography</span>
            </div>
          </div>
        </div>
      </a>

      <!-- NY Imaging Lake Success -->
      <a href="/locations/lake-success.html" class="location-card-link" data-region="nassau" data-services="pet-ct mri ct interventional-radiology mammography ultrasound x-ray" data-name="NY Imaging Lake Success" data-address="1 Delaware Drive, Lake Success, NY 11042" data-lat="40.7701" data-lng="-73.7151">
        <div class="location-card">
          <div class="location-image"><img src="/img/lakesuccess.jpeg" alt="NY Imaging Lake Success"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Lake Success</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 1 Delaware Drive, Lake Success, NY 11042</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Fri: 7am-7pm, Sat: 8am-4pm; Select Sundays: 8am-4pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">PET/CT</span>
              <span class="specialty-tag">MRI</span>
              <span class="specialty-tag">CT</span>
              <span class="specialty-tag">IR</span>
            </div>
          </div>
        </div>
      </a>

      <!-- NY Imaging Forest Hills -->
      <a href="/locations/forest-hills.html" class="location-card-link" data-region="queens" data-services="pet-ct ct ultrasound" data-name="NY Imaging Forest Hills" data-address="92-37 Metropolitan Avenue, Forest Hills, NY 11375" data-lat="40.7180" data-lng="-73.8448">
        <div class="location-card">
          <div class="location-image"><img src="/img/foresthills.jpg" alt="NY Imaging Forest Hills"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Forest Hills</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 92-37 Metropolitan Avenue, Forest Hills, NY 11375</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Fri: 8am-6pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">PET/CT</span>
              <span class="specialty-tag">CT</span>
              <span class="specialty-tag">Ultrasound</span>
            </div>
          </div>
        </div>
      </a>

      <!-- NY Imaging Staten Island -->
      <a href="/locations/staten-island.html" class="location-card-link" data-region="staten-island" data-services="pet-ct mri ct mammography ultrasound x-ray" data-name="NY Imaging Staten Island" data-address="2801 Richmond Avenue, Staten Island, NY 10314" data-lat="40.5795" data-lng="-74.1690">
        <div class="location-card">
          <div class="location-image"><img src="/img/statenisland.jpg" alt="NY Imaging Staten Island"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Staten Island</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 2801 Richmond Avenue, Staten Island, NY 10314</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Thurs: 8am-5pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">PET/CT</span>
              <span class="specialty-tag">MRI</span>
              <span class="specialty-tag">CT</span>
            </div>
          </div>
        </div>
      </a>

      <!-- NY Imaging Port Jefferson -->
      <a href="/locations/port-jefferson.html" class="location-card-link" data-region="suffolk" data-services="pet-ct mri ct ultrasound" data-name="NY Imaging Port Jefferson" data-address="1500 Route 112, Port Jefferson Station, NY 11776" data-lat="40.9268" data-lng="-73.0523">
        <div class="location-card">
          <div class="location-image"><img src="/img/portjeffBld2.jpg" alt="NY Imaging Port Jefferson"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Port Jefferson</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 1500 Route 112, Port Jefferson Station, NY 11776</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Fri: 7am-7pm; Sat: 8am-4pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">PET/CT</span>
              <span class="specialty-tag">MRI</span>
              <span class="specialty-tag">CT</span>
            </div>
          </div>
        </div>
      </a>

      <!-- NY Imaging Port Jefferson Station -->
      <a href="/locations/port-jefferson-station.html" class="location-card-link" data-region="suffolk" data-services="mri mammography ultrasound bone-density x-ray" data-name="NY Imaging Port Jefferson Station" data-address="5316 Nesconset Highway, Port Jefferson Station, NY 11776" data-lat="40.9150" data-lng="-73.0700">
        <div class="location-card">
          <div class="location-image"><img src="/img/portjeff5316.jpg" alt="NY Imaging Port Jefferson Station"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Port Jefferson Station</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 5316 Nesconset Highway, Port Jefferson Station, NY 11776</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Fri: 7:30am-5pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">MRI</span>
              <span class="specialty-tag">Mammography</span>
              <span class="specialty-tag">Ultrasound</span>
            </div>
          </div>
        </div>
      </a>

      <!-- NY Imaging Setauket -->
      <a href="/locations/setauket.html" class="location-card-link" data-region="suffolk" data-services="pet-ct ct ultrasound" data-name="NY Imaging Setauket" data-address="49 Route 347, Port Jefferson Station, NY 11776" data-lat="40.9312" data-lng="-73.0856">
        <div class="location-card">
          <div class="location-image"><img src="/img/portjeff347.jpg" alt="NY Imaging Setauket"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Setauket</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 49 Route 347, Port Jefferson Station, NY 11776</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Fri: 8am-5pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">PET/CT</span>
              <span class="specialty-tag">CT</span>
              <span class="specialty-tag">Ultrasound</span>
            </div>
          </div>
        </div>
      </a>

      <!-- East End Health -->
      <a href="/locations/westhampton-beach.html" class="location-card-link" data-region="suffolk" data-services="mri mammography ultrasound bone-density" data-name="East End Health and Imaging Center" data-address="40 Main Street, Westhampton Beach, NY 11978" data-lat="40.8126" data-lng="-72.6468">
        <div class="location-card">
          <div class="location-image"><img src="https://via.placeholder.com/500x250?text=Westhampton+Beach" alt="East End Health"></div>
          <div class="location-content">
            <h3 class="location-name">East End Health and Imaging Center</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 40 Main Street, Westhampton Beach, NY 11978</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Fri: 7:30am-5pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">MRI</span>
              <span class="specialty-tag">Mammography</span>
              <span class="specialty-tag">Ultrasound</span>
            </div>
          </div>
        </div>
      </a>

      <!-- NY Imaging Riverhead -->
      <a href="/locations/riverhead.html" class="location-card-link" data-region="suffolk" data-services="pet-ct ct ultrasound" data-name="NY Imaging Riverhead" data-address="750 Old Country Road, Riverhead, NY 11901" data-lat="40.9168" data-lng="-72.6618">
        <div class="location-card">
          <div class="location-image"><img src="/img/riverhead.jpg" alt="NY Imaging Riverhead"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Riverhead</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 750 Old Country Road, Riverhead, NY 11901</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Fri: 8am-5pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">PET/CT</span>
              <span class="specialty-tag">CT</span>
              <span class="specialty-tag">Ultrasound</span>
            </div>
          </div>
        </div>
      </a>

      <!-- NY Imaging Patchogue 365 -->
      <a href="/locations/patchogue.html" class="location-card-link" data-region="suffolk" data-services="pet-ct ultrasound" data-name="NY Imaging Patchogue" data-address="365 East Main Street, Patchogue, NY 11772" data-lat="40.7654" data-lng="-73.0151">
        <div class="location-card">
          <div class="location-image"><img src="/img/patchogue365.jpg" alt="NY Imaging Patchogue"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Patchogue</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 365 East Main Street, Patchogue, NY 11772</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Fri: 8am-5pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">PET/CT</span>
              <span class="specialty-tag">Ultrasound</span>
            </div>
          </div>
        </div>
      </a>

      <!-- NY Imaging Patchogue 214 -->
      <a href="/locations/patchogue-214.html" class="location-card-link" data-region="suffolk" data-services="ct interventional-radiology mammography ultrasound bone-density x-ray" data-name="NY Imaging Patchogue" data-address="214 East Main Street, Patchogue, NY 11772" data-lat="40.7650" data-lng="-73.0180">
        <div class="location-card">
          <div class="location-image"><img src="/img/patchogue214.jpg" alt="NY Imaging Patchogue"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Patchogue</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 214 East Main Street, Patchogue, NY 11772</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> Mon-Fri: 8am-5pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">CT</span>
              <span class="specialty-tag">IR</span>
              <span class="specialty-tag">Mammography</span>
            </div>
          </div>
        </div>
      </a>

      <!-- NY Imaging Southampton -->
      <a href="/locations/southampton.html" class="location-card-link" data-region="suffolk" data-services="pet-ct ct" data-name="NY Imaging Southampton" data-address="640 County Road 39, Southampton, NY 11968" data-lat="40.8843" data-lng="-72.4251">
        <div class="location-card">
          <div class="location-image"><img src="/img/southampton.jpg" alt="NY Imaging Southampton"></div>
          <div class="location-content">
            <h3 class="location-name">NY Imaging Southampton</h3>
            <div class="location-info">
              <div class="location-info-item"><i class="fas fa-map-marker-alt"></i> 640 County Road 39, Southampton, NY 11968</div>
              <div class="location-info-item"><i class="fas fa-phone"></i> (833) 269-4624</div>
              <div class="location-info-item"><i class="fas fa-clock"></i> 2 Days Per Week: 8am-4pm</div>
            </div>
            <div class="location-specialties">
              <span class="specialty-tag">PET/CT</span>
              <span class="specialty-tag">CT</span>
            </div>
          </div>
        </div>
      </a>
    </div>
    
    <div class="no-results-box" id="no-results" style="display: none;">
      <h3>No locations found</h3>
      <p>No locations match your search or filters. Try adjusting your criteria.</p>
      <button class="btn btn-primary" onclick="resetFilters()">Show All Locations</button>
    </div>
  </div>
</section>

<section class="provider-cta-section">
  <div class="cta-content">
    <h2>Ready to Schedule Your Imaging?</h2>
    <p>Our team is here to help you get the diagnostic imaging you need quickly and comfortably.</p>
    <div class="cta-buttons">
      <a href="/request-appointment" class="btn btn-blue"><i class="fas fa-calendar-check"></i> Request Appointment</a>
      <a href="tel:8332694624" class="btn btn-secondary"><i class="fas fa-phone"></i> Call (833) 269-4624</a>
    </div>
  </div>
</section>

<div id="footer-placeholder"></div>

<script src="/js/navigation.js"></script>
<script src="/js/components.js"></script>
<script src="/js/header-scroll.js"></script>
<script src="/js/ny-towns.js"></script>

<script>
// ================================================
// ENHANCED SEARCH WITH AUTOCOMPLETE
// ================================================

const SearchEngine = {
  // Services data with aliases
  services: [
    { id: 'mri', name: 'MRI', aliases: ['magnetic resonance', 'mr scan'], icon: 'fa-magnet' },
    { id: 'ct', name: 'CT Scan', aliases: ['cat scan', 'computed tomography', 'catscan'], icon: 'fa-circle-dot' },
    { id: 'pet-ct', name: 'PET/CT', aliases: ['pet', 'petct', 'pet ct', 'positron emission'], icon: 'fa-atom' },
    { id: 'mammography', name: 'Mammography', aliases: ['mammo', 'breast imaging', 'breast scan'], icon: 'fa-ribbon' },
    { id: 'ultrasound', name: 'Ultrasound', aliases: ['sonogram', 'sono', 'sonography'], icon: 'fa-wave-square' },
    { id: 'bone-density', name: 'Bone Density', aliases: ['dexa', 'dxa', 'bone scan', 'osteoporosis'], icon: 'fa-bone' },
    { id: 'x-ray', name: 'X-Ray', aliases: ['xray', 'radiograph'], icon: 'fa-x-ray' },
    { id: 'interventional-radiology', name: 'Interventional Radiology', aliases: ['ir', 'interventional', 'minimally invasive'], icon: 'fa-syringe' }
  ],

  // NY towns loaded from external file (js/ny-towns.js)
  towns: typeof NYTowns !== 'undefined' ? NYTowns : [],

  // Location data (built from DOM)
  locations: [],

  init() {
    // Build locations array from DOM
    document.querySelectorAll('.location-card-link').forEach(card => {
      this.locations.push({
        name: card.dataset.name,
        address: card.dataset.address,
        region: card.dataset.region,
        services: card.dataset.services.split(' '),
        lat: parseFloat(card.dataset.lat),
        lng: parseFloat(card.dataset.lng),
        href: card.getAttribute('href'),
        element: card
      });
    });
  },

  // Calculate distance between two points (Haversine formula)
  getDistance(lat1, lng1, lat2, lng2) {
    const R = 3959; // Earth's radius in miles
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLng = (lng2 - lng1) * Math.PI / 180;
    const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
              Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
              Math.sin(dLng/2) * Math.sin(dLng/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
  },

  // Get all locations within a radius (in miles)
  getLocationsWithinRadius(lat, lng, radiusMiles = 25) {
    return this.locations
      .map(loc => ({ ...loc, distance: this.getDistance(lat, lng, loc.lat, loc.lng) }))
      .filter(loc => loc.distance <= radiusMiles)
      .sort((a, b) => a.distance - b.distance);
  },

  // Search for suggestions
  search(query) {
    if (!query || query.length < 2) return { services: [], locations: [], towns: [] };
    
    const q = query.toLowerCase().trim();
    const results = { services: [], locations: [], towns: [] };

    // Search services
    this.services.forEach(service => {
      const nameMatch = service.name.toLowerCase().includes(q);
      const aliasMatch = service.aliases.some(a => a.includes(q));
      if (nameMatch || aliasMatch) {
        results.services.push(service);
      }
    });

    // Search locations (our offices)
    this.locations.forEach(loc => {
      const nameMatch = loc.name.toLowerCase().includes(q);
      const addressMatch = loc.address.toLowerCase().includes(q);
      const regionMatch = loc.region.replace('-', ' ').includes(q);
      if (nameMatch || addressMatch || regionMatch) {
        results.locations.push(loc);
      }
    });

    // Search towns - include ALL matching towns (even if we have a location there)
    // This lets users see "nearby locations" view for any town
    this.towns.forEach(town => {
      const nameMatch = town.name.toLowerCase().includes(q);
      const zipMatch = town.zip && town.zip.includes(q);
      const countyMatch = town.county && town.county.toLowerCase().includes(q);
      if (nameMatch || zipMatch || countyMatch) {
        const nearby = this.getLocationsWithinRadius(town.lat, town.lng, 25);
        if (nearby.length > 0) {
          results.towns.push({ ...town, closestLocations: nearby });
        }
      }
    });

    // Limit results
    results.services = results.services.slice(0, 4);
    results.locations = results.locations.slice(0, 5);
    results.towns = results.towns.slice(0, 4);

    return results;
  },

  // Highlight matching text
  highlight(text, query) {
    if (!query) return text;
    const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
    return text.replace(regex, '<span class="highlight">$1</span>');
  }
};

// ================================================
// UI CONTROLLER
// ================================================

document.addEventListener('DOMContentLoaded', function() {
  SearchEngine.init();

  const searchInput = document.getElementById('location-search');
  const searchClear = document.getElementById('search-clear');
  const searchWrapper = document.getElementById('search-wrapper');
  const dropdown = document.getElementById('suggestions-dropdown');
  const filterToggle = document.getElementById('filter-toggle');
  const filterContent = document.getElementById('filter-content');
  const filterCountBadge = document.getElementById('filter-count');
  const activeFilterSummary = document.getElementById('active-filter-summary');
  const regionButtons = document.querySelectorAll('#region-filters .filter-btn');
  const serviceButtons = document.querySelectorAll('#service-filters .filter-btn');
  const locationCards = document.querySelectorAll('.location-card-link');
  const resultsCount = document.getElementById('results-count');
  const noResults = document.getElementById('no-results');
  const locationsGrid = document.getElementById('locations-grid');

  let activeRegion = 'all';
  let activeService = 'all';
  let searchQuery = '';
  let highlightedIndex = -1;
  let currentSuggestions = [];

  const filterDisplayNames = {
    'bronx': 'Bronx', 'brooklyn': 'Brooklyn', 'manhattan': 'Manhattan',
    'nassau': 'Nassau', 'queens': 'Queens', 'staten-island': 'Staten Island',
    'suffolk': 'Suffolk', 'mri': 'MRI', 'ct': 'CT', 'pet-ct': 'PET/CT',
    'mammography': 'Mammography', 'ultrasound': 'Ultrasound',
    'bone-density': 'Bone Density', 'x-ray': 'X-Ray',
    'interventional-radiology': 'Interventional Radiology'
  };

  // Build dropdown HTML
  function buildDropdown(results, query) {
    let html = '';
    currentSuggestions = [];

    if (results.services.length > 0) {
      html += '<div class="suggestion-group"><div class="suggestion-group-header">Services</div>';
      results.services.forEach(service => {
        currentSuggestions.push({ type: 'service', data: service });
        html += `
          <div class="suggestion-item" data-type="service" data-id="${service.id}">
            <div class="suggestion-icon service"><i class="fas ${service.icon}"></i></div>
            <div class="suggestion-content">
              <div class="suggestion-title">${SearchEngine.highlight(service.name, query)}</div>
              <div class="suggestion-subtitle">Filter by this service</div>
            </div>
            <span class="suggestion-badge">${SearchEngine.locations.filter(l => l.services.includes(service.id)).length} locations</span>
          </div>`;
      });
      html += '</div>';
    }

    if (results.locations.length > 0) {
      html += '<div class="suggestion-group"><div class="suggestion-group-header">Our Locations</div>';
      results.locations.forEach(loc => {
        currentSuggestions.push({ type: 'location', data: loc });
        html += `
          <div class="suggestion-item" data-type="location" data-href="${loc.href}">
            <div class="suggestion-icon location"><i class="fas fa-building"></i></div>
            <div class="suggestion-content">
              <div class="suggestion-title">${SearchEngine.highlight(loc.name, query)}</div>
              <div class="suggestion-subtitle">${SearchEngine.highlight(loc.address, query)}</div>
            </div>
          </div>`;
      });
      html += '</div>';
    }

    if (results.towns.length > 0) {
      html += '<div class="suggestion-group"><div class="suggestion-group-header">Search by Town</div>';
      results.towns.forEach(town => {
        currentSuggestions.push({ type: 'town', data: town });
        const closest = town.closestLocations[0];
        const countText = town.closestLocations.length === 1 ? '1 location' : town.closestLocations.length + ' locations';
        html += `
          <div class="suggestion-item" data-type="town" data-lat="${town.lat}" data-lng="${town.lng}" data-name="${town.name}">
            <div class="suggestion-icon town"><i class="fas fa-map-pin"></i></div>
            <div class="suggestion-content">
              <div class="suggestion-title">${SearchEngine.highlight(town.name, query)}, ${town.state}</div>
              <div class="suggestion-subtitle">Nearest: ${closest.name} (${closest.distance.toFixed(1)} mi away)</div>
            </div>
            <span class="suggestion-badge distance">${countText} within 25 mi</span>
          </div>`;
      });
      html += '</div>';
    }

    if (!html) {
      html = '<div class="no-suggestions"><i class="fas fa-search"></i>No results found for "' + query + '"</div>';
    }

    return html;
  }

  // Show/hide dropdown
  function showDropdown(show) {
    if (show) {
      dropdown.classList.add('visible');
      searchWrapper.classList.add('has-suggestions');
      searchInput.setAttribute('aria-expanded', 'true');
    } else {
      dropdown.classList.remove('visible');
      searchWrapper.classList.remove('has-suggestions');
      searchInput.setAttribute('aria-expanded', 'false');
      highlightedIndex = -1;
    }
  }

  // Handle search input
  let debounceTimer;
  searchInput.addEventListener('input', function() {
    const query = this.value.trim();
    searchClear.classList.toggle('visible', query.length > 0);
    
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
      if (query.length >= 2) {
        const results = SearchEngine.search(query);
        dropdown.innerHTML = buildDropdown(results, query);
        showDropdown(true);
        highlightedIndex = -1;
      } else {
        showDropdown(false);
      }
    }, 150);
  });

  // Handle keyboard navigation
  searchInput.addEventListener('keydown', function(e) {
    const items = dropdown.querySelectorAll('.suggestion-item');
    
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      highlightedIndex = Math.min(highlightedIndex + 1, items.length - 1);
      updateHighlight(items);
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      highlightedIndex = Math.max(highlightedIndex - 1, 0);
      updateHighlight(items);
    } else if (e.key === 'Enter' && highlightedIndex >= 0) {
      e.preventDefault();
      items[highlightedIndex].click();
    } else if (e.key === 'Escape') {
      showDropdown(false);
      searchInput.blur();
    }
  });

  function updateHighlight(items) {
    items.forEach((item, i) => {
      item.classList.toggle('highlighted', i === highlightedIndex);
    });
    if (highlightedIndex >= 0) {
      items[highlightedIndex].scrollIntoView({ block: 'nearest' });
    }
  }

  // Handle suggestion clicks
  dropdown.addEventListener('click', function(e) {
    const item = e.target.closest('.suggestion-item');
    if (!item) return;

    const type = item.dataset.type;

    if (type === 'service') {
      // Activate service filter
      const serviceId = item.dataset.id;
      const btn = document.querySelector(`#service-filters .filter-btn[data-filter="${serviceId}"]`);
      if (btn) btn.click();
      searchInput.value = '';
      searchQuery = '';
      showDropdown(false);
    } else if (type === 'location') {
      // Navigate to location
      window.location.href = item.dataset.href;
    } else if (type === 'town') {
      // Show closest locations to this town
      const townData = currentSuggestions.find(s => s.type === 'town' && s.data.name === item.dataset.name);
      if (townData) {
        showClosestLocations(townData.data);
      }
      searchInput.value = item.dataset.name + ', NY';
      showDropdown(false);
    }
  });

  // Show closest locations for a town
  function showClosestLocations(town) {
    const closest = town.closestLocations;
    const contextBanner = document.getElementById('search-context-banner');
    const contextCount = document.getElementById('context-count');
    const contextLocation = document.getElementById('context-location');
    
    // First, hide all cards and remove old distance badges
    locationCards.forEach(card => {
      card.style.display = 'none';
      const oldBadge = card.querySelector('.distance-badge');
      if (oldBadge) oldBadge.remove();
    });

    // Reorder DOM elements by distance (closest first)
    closest.forEach((loc) => {
      const card = Array.from(locationCards).find(c => c.getAttribute('href') === loc.href);
      if (card) {
        // Move card to end of grid (maintains sorted order since we iterate in order)
        locationsGrid.appendChild(card);
        card.style.display = 'flex';
        
        // Create and add distance badge
        const badge = document.createElement('div');
        badge.className = 'distance-badge visible';
        badge.innerHTML = `<i class="fas fa-route"></i> <span class="miles">${loc.distance.toFixed(1)}</span> mi`;
        
        const imageDiv = card.querySelector('.location-image');
        if (imageDiv) {
          imageDiv.appendChild(badge);
        }
      }
    });

    // Update results count
    resultsCount.textContent = closest.length;
    noResults.style.display = 'none';
    locationsGrid.style.display = '';
    
    // Show context banner
    contextCount.textContent = closest.length;
    contextLocation.textContent = town.name + ', NY';
    contextBanner.classList.add('visible');
    
    // Reset filter buttons visually
    regionButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.filter === 'all'));
    serviceButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.filter === 'all'));
    activeRegion = 'all';
    activeService = 'all';
    updateFilterSummary();
  }

  // Clear search
  searchClear.addEventListener('click', function() {
    searchInput.value = '';
    searchQuery = '';
    searchClear.classList.remove('visible');
    showDropdown(false);
    resetFilters();
    searchInput.focus();
  });

  // Close dropdown on outside click
  document.addEventListener('click', function(e) {
    if (!searchWrapper.contains(e.target) && !dropdown.contains(e.target)) {
      showDropdown(false);
    }
  });

  // Mobile filter toggle
  filterToggle.addEventListener('click', function() {
    const isOpen = filterContent.classList.contains('open');
    filterContent.classList.toggle('open', !isOpen);
    filterToggle.classList.toggle('active', !isOpen);
    filterToggle.setAttribute('aria-expanded', !isOpen);
  });

  function updateFilterSummary() {
    let summaryHTML = '';
    let activeCount = 0;
    
    if (activeRegion !== 'all') {
      summaryHTML += `<span class="active-filter-pill"><i class="fas fa-map-marker-alt"></i> ${filterDisplayNames[activeRegion]}</span>`;
      activeCount++;
    }
    if (activeService !== 'all') {
      summaryHTML += `<span class="active-filter-pill"><i class="fas fa-x-ray"></i> ${filterDisplayNames[activeService]}</span>`;
      activeCount++;
    }
    
    activeFilterSummary.innerHTML = summaryHTML;
    filterCountBadge.textContent = activeCount > 0 ? activeCount + ' active' : 'All';
    activeFilterSummary.classList.toggle('has-filters', activeCount > 0);
  }

  function filterLocations() {
    let visibleCount = 0;
    
    // Hide context banner when using regular filters
    document.getElementById('search-context-banner')?.classList.remove('visible');
    
    locationCards.forEach(card => {
      const region = card.dataset.region;
      const services = card.dataset.services;
      
      const matchesRegion = activeRegion === 'all' || region === activeRegion;
      const matchesService = activeService === 'all' || services.includes(activeService);
      
      if (matchesRegion && matchesService) {
        card.style.display = 'flex';
        visibleCount++;
        // Remove any distance badges
        const badge = card.querySelector('.distance-badge');
        if (badge) badge.remove();
      } else {
        card.style.display = 'none';
      }
    });
    
    resultsCount.textContent = visibleCount;
    noResults.style.display = visibleCount === 0 ? 'block' : 'none';
    locationsGrid.style.display = visibleCount === 0 ? 'none' : '';
    
    updateFilterSummary();
  }

  // Region filter clicks
  regionButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      if (this.disabled) return;
      activeRegion = this.dataset.filter;
      regionButtons.forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      filterLocations();
    });
  });

  // Service filter clicks
  serviceButtons.forEach(btn => {
    btn.addEventListener('click', function() {
      if (this.disabled) return;
      activeService = this.dataset.filter;
      serviceButtons.forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      filterLocations();
    });
  });

  // Initial setup
  updateFilterSummary();
});

function resetFilters() {
  // Reset filter buttons
  document.querySelector('#region-filters .filter-btn[data-filter="all"]')?.click();
  document.querySelector('#service-filters .filter-btn[data-filter="all"]')?.click();
  
  // Clear search input
  const searchInput = document.getElementById('location-search');
  if (searchInput) {
    searchInput.value = '';
    document.getElementById('search-clear').classList.remove('visible');
  }
  
  // Hide context banner
  document.getElementById('search-context-banner')?.classList.remove('visible');
  
  // Remove all distance badges and show all cards
  document.querySelectorAll('.location-card-link').forEach(card => {
    card.style.display = 'flex';
    const badge = card.querySelector('.distance-badge');
    if (badge) badge.remove();
  });
  
  // Update count
  document.getElementById('results-count').textContent = document.querySelectorAll('.location-card-link').length;
  document.getElementById('no-results').style.display = 'none';
  document.getElementById('locations-grid').style.display = '';
}
</script>

</body>
</html>